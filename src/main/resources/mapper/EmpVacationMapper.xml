<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="EmpVacationMapper"> <!-- ✅ 통일 -->

  <resultMap id="EmpVacationDtoMap" type="com.example.gymerp.dto.EmpVacationDto">
    <id     property="vacNum"       column="vacNum"/>
    <result property="empNum"       column="empNum"/>
    <result property="vacStartedAt" column="vacStartedAt"/>
    <result property="vacEndedAt"   column="vacEndedAt"/>
    <result property="vacContent"   column="vacContent"/>
    <result property="vacState"     column="vacState"/>
    <result property="earnedDays"    column="earnedDays"/>
    <result property="remainingDays" column="remainingDays"/>
    <result property="usedDays"      column="usedDays"/>
  </resultMap>

  <select id="selectAllEmpVacations" resultMap="EmpVacationDtoMap">
    SELECT v.vacNum, v.empNum, v.vacStartedAt, v.vacEndedAt, v.vacContent, v.vacState,
           d.earnedDays, d.remainingDays, d.usedDays
      FROM vacation v
      LEFT JOIN vacationdays d ON d.empNum = v.empNum
     ORDER BY v.vacNum DESC
  </select>

  <select id="selectEmpVacationById" parameterType="int" resultMap="EmpVacationDtoMap">
    SELECT v.vacNum, v.empNum, v.vacStartedAt, v.vacEndedAt, v.vacContent, v.vacState,
           d.earnedDays, d.remainingDays, d.usedDays
      FROM vacation v
      LEFT JOIN vacationdays d ON d.empNum = v.empNum
     WHERE v.vacNum = #{value} <!-- ✅ 또는 @Param("vacNum") 쓰면 #{vacNum} -->
  </select>

  <select id="selectEmpVacationsByEmpNum" parameterType="int" resultMap="EmpVacationDtoMap">
    SELECT v.vacNum, v.empNum, v.vacStartedAt, v.vacEndedAt, v.vacContent, v.vacState,
           d.earnedDays, d.remainingDays, d.usedDays
      FROM vacation v
      LEFT JOIN vacationdays d ON d.empNum = v.empNum
     WHERE v.empNum = #{value}   <!-- ✅ 또는 @Param("empNum") 쓰면 #{empNum} -->
     ORDER BY v.vacStartedAt DESC, v.vacNum DESC
  </select>

  <select id="selectEmpVacationsByRange" resultMap="EmpVacationDtoMap">
    SELECT v.vacNum, v.empNum, v.vacStartedAt, v.vacEndedAt, v.vacContent, v.vacState,
           d.earnedDays, d.remainingDays, d.usedDays
      FROM vacation v
      LEFT JOIN vacationdays d ON d.empNum = v.empNum
     WHERE v.empNum = #{empNum}
       AND v.vacStartedAt &lt;= #{to}
       AND v.vacEndedAt   &gt;= #{from}
     ORDER BY v.vacStartedAt DESC, v.vacNum DESC
  </select>

  <insert id="insertEmpVacation" parameterType="com.example.gymerp.dto.EmpVacationDto">
    INSERT INTO vacation (vacNum, empNum, vacStartedAt, vacEndedAt, vacContent, vacState)
    VALUES (#{vacNum}, #{empNum}, #{vacStartedAt,jdbcType=DATE}, #{vacEndedAt,jdbcType=DATE}, #{vacContent}, #{vacState})
  </insert>

  <update id="updateEmpVacation" parameterType="com.example.gymerp.dto.EmpVacationDto">
    UPDATE vacation
       SET empNum = #{empNum},
           vacStartedAt = #{vacStartedAt,jdbcType=DATE},
           vacEndedAt   = #{vacEndedAt,jdbcType=DATE},
           vacContent   = #{vacContent},
           vacState     = #{vacState}
     WHERE vacNum = #{vacNum}
  </update>

  <update id="updateEmpVacationState" parameterType="map">
    UPDATE vacation
       SET vacState = #{vacState}
     WHERE vacNum  = #{vacNum}
  </update>

  <delete id="deleteEmpVacation" parameterType="int">
    DELETE FROM vacation WHERE vacNum = #{value} <!-- 또는 @Param 사용 -->
  </delete>

</mapper>
