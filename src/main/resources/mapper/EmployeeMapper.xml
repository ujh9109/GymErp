<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="EmployeeMapper">

	<!-- 직원 전체 조회 -->
    <select id="getAllEmp" resultType="EmpDto">
        SELECT * FROM EMPLOYEE
        ORDER BY EMPNUM DESC
    </select>

    <!-- 직원 상세 조회 -->
    <select id="getEmpByNum" parameterType="int" resultType="EmpDto">
        SELECT * FROM EMPLOYEE
        WHERE EMPNUM = #{empNum}
    </select>

    <!-- 직원 등록 -->
    <insert id="insertEmp" parameterType="EmpDto">
        INSERT INTO EMPLOYEE (
            EMPNUM, EMPNAME, GENDER, EMPADDRESS, EMPBIRTH,
            EMPPHONE, EMPEMAIL, HIREDATE, FIREDATE,
            PROFILEIMAGE, EMPMEMO, ROLE
        ) VALUES (
            #{empNum}, #{empName}, #{gender}, #{empAddress}, #{empBirth},
            #{empPhone}, #{empEmail}, #{hireDate}, #{fireDate},
            #{profileImage}, #{empMemo}, #{role}
        )
    </insert>

    <!-- 직원 수정 -->
    <update id="updateEmp" parameterType="EmpDto">
        UPDATE EMPLOYEE
        SET EMPNAME = #{empName},
            GENDER = #{gender},
            EMPADDRESS = #{empAddress},
            EMPBIRTH = #{empBirth},
            EMPPHONE = #{empPhone},
            EMPEMAIL = #{empEmail},
            FIREDATE = #{fireDate},
            PROFILEIMAGE = #{profileImage},
            EMPMEMO = #{empMemo},
            ROLE = #{role}
        WHERE EMPNUM = #{empNum}
    </update>

    <!-- 직원 삭제 -->
    <delete id="deleteEmp" parameterType="int">
        DELETE FROM EMPLOYEE WHERE EMPNUM = #{empNum}
    </delete>

    <!-- 검색 (필터 + 키워드) -->
    <select id="searchEmp" resultType="EmpDto">
        SELECT *
        FROM EMPLOYEE
        <where>
            <if test="filter == 'all'">
                (EMPNAME LIKE '%' || #{keyword} || '%' 
                 OR EMPEMAIL LIKE '%' || #{keyword} || '%')
            </if>

            <if test="filter == 'name'">
                EMPNAME LIKE '%' || #{keyword} || '%'
            </if>

            <if test="filter == 'email'">
                EMPEMAIL LIKE '%' || #{keyword} || '%'
            </if>
        </where>
        ORDER BY EMPNUM DESC
    </select>
    
    
    
    
    
    <!-- 이용내역 DB 관련 내용입니다.  -->
    
    <!-- 직원 이름 단건 조회 (로그용: empNum → empName 매핑) -->
    <select id="selectEmployeeNameById" parameterType="int" resultType="string">
        SELECT empName
        FROM EMPLOYEE
        WHERE empNum = #{empNum}
    </select>

    <!-- 직원 존재 여부 확인 (판매 등록 시 유효성 검증용) -->
    <select id="checkEmployeeExists" parameterType="int" resultType="int">
        SELECT COUNT(*)
        FROM EMPLOYEE
        WHERE empNum = #{empNum}
    </select>


</mapper>