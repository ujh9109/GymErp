<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="EmployeeMapper">

	<!-- 직원 전체 조회 -->
    <select id="getAllEmp" resultType="EmpDto">
        SELECT * FROM EMPLOYEE
        ORDER BY EMPNUM DESC
    </select>

    <!-- 직원 상세 조회 -->
    <select id="getEmpByNum" parameterType="int" resultType="EmpDto">
        SELECT * FROM EMPLOYEE
        WHERE EMPNUM = #{empNum}
    </select>

    <!-- 직원 등록: sequence 로 PK 발급 + 비번 포함 -->
    <insert id="insertEmp" parameterType="EmpDto">
    	<selectKey keyProperty="empNum" resultType="int" order="BEFORE">
    		SELECT employee_seq.NEXTVAL FROM DUAL
    	</selectKey>
        INSERT INTO EMPLOYEE (
            EMPNUM, EMPNAME, GENDER, EMPADDRESS, EMPBIRTH,
            EMPPHONE, EMPEMAIL, PASSWORD, HIREDATE, FIREDATE,
            PROFILEIMAGE, EMPMEMO, ROLE
        ) VALUES (
                #{empNum, jdbcType=NUMERIC},
				#{empName, jdbcType=VARCHAR},
				#{gender, jdbcType=VARCHAR},
				#{empAddress, jdbcType=VARCHAR},
				#{empBirth, jdbcType=DATE},
				#{empPhone, jdbcType=VARCHAR},
				#{empEmail, jdbcType=VARCHAR},
				#{password, jdbcType=VARCHAR},
				#{hireDate, jdbcType=DATE},
				#{fireDate, jdbcType=DATE},
				#{profileImage, jdbcType=VARCHAR},
				#{empMemo, jdbcType=VARCHAR},
				#{role, jdbcType=VARCHAR}
        )
    </insert>

    <!-- 직원 수정 -->
    <update id="updateEmp" parameterType="EmpDto">
        UPDATE EMPLOYEE
        SET EMPNAME = #{empName},
            GENDER = #{gender},
            EMPADDRESS = #{empAddress},
            EMPBIRTH = #{empBirth},
            EMPPHONE = #{empPhone},
            EMPEMAIL = #{empEmail},
            FIREDATE = #{fireDate},
            PROFILEIMAGE = #{profileImage},
            EMPMEMO = #{empMemo},
            ROLE = #{role}
        WHERE EMPNUM = #{empNum}
    </update>

    <!-- 직원 삭제 -->
    <delete id="deleteEmp" parameterType="int">
        DELETE FROM EMPLOYEE WHERE EMPNUM = #{empNum}
    </delete>

    <!-- 검색 (필터 + 키워드) -->
    <select id="searchEmp" resultType="EmpDto">
        SELECT *
        FROM EMPLOYEE
        <where>
            <if test="filter == 'all'">
                (EMPNAME LIKE '%' || #{keyword} || '%' 
                 OR EMPEMAIL LIKE '%' || #{keyword} || '%')
            </if>

            <if test="filter == 'name'">
                EMPNAME LIKE '%' || #{keyword} || '%'
            </if>

            <if test="filter == 'email'">
                EMPEMAIL LIKE '%' || #{keyword} || '%'
            </if>
        </where>
        ORDER BY EMPNUM DESC
    </select>
    
    <!-- 로그인 전용: 이메일로 비번 포함 조회 -->
    <resultMap type="EmpDto" id="empAuthMap">
    	<id property="empNum" column="EMPNUM"/>
    	<result property="empName" column="EMPNAME"/>
    	<result property="empEmail" column="EMPEMAIL"/>
    	<result property="password" column="PASSWORD"/>
    	<result property="role" column="ROLE"/>
    </resultMap>
    
    <select id="selectAuthByEmail" parameterType="string" resultMap="empAuthMap">
    	SELECT EMPNUM, EMPNAME, EMPEMAIL, PASSWORD, ROLE
    		FROM EMPLOYEE
    	WHERE EMPEMAIL = #{empEmail}
    </select>
    
    <!-- 비밀번호만 변경 -->
    <update id="updatePassword">
    	UPDATE EMPLOYEE
    		SET PASSWORD = #{password}
    	WHERE EMPNUM = #{empNum}
    </update>


</mapper>